<div class="card h-100">
  <div class="card-body d-flex flex-column gap-3">
    <div class="d-flex align-items-center">
      <h6 class="mb-0 flex-grow-1">Envelopes</h6>
      <button type="button" class="btn btn-primary btn-sm" (click)="toggleForm()" [disabled]="!monthId">
        {{ showForm ? 'Close' : 'Add Envelope' }}
      </button>
    </div>
    <div *ngIf="showForm">
      <app-envelope-form (envelopeAdded)="onEnvelopeAdded($event)" (closed)="toggleForm()"></app-envelope-form>
    </div>
    <div *ngIf="!monthId" class="text-muted small">Select a month to view envelopes.</div>
    <div *ngIf="loading" class="text-muted small">Loading envelopes...</div>
    <div *ngIf="error" class="text-danger small">{{ error }}</div>
    <div class="list-group">
      <button
        type="button"
        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        *ngFor="let env of envelopes"
        [class.active]="env._id === selectedEnvelopeId"
        (click)="onSelect(env._id || env.name)">
        <div>
          <div class="fw-semibold">{{ env.name }}</div>
          <small class="text-muted">Allocated: {{ formatAllocated(env.allocated) }}</small>
        </div>
        <span
          class="badge"
          [class.text-bg-success]="remainingValue(env.remaining, env.allocated) >= 0"
          [class.text-bg-danger]="remainingValue(env.remaining, env.allocated) < 0">
          Remaining {{ formatRemaining(env.remaining, env.allocated) }}
        </span>
      </button>
      <div *ngIf="!loading && !error && monthId && envelopes.length === 0" class="list-group-item text-muted">
        No envelopes yet.
      </div>
    </div>
  </div>
</div>
