<div class="card h-100">
  <div class="card-body d-flex flex-column gap-3">
    <div class="d-flex align-items-center gap-2">
      <h6 class="mb-0 flex-grow-1">Envelopes</h6>
      <button type="button" class="btn btn-primary btn-sm" (click)="toggleForm()" [disabled]="!monthId">
        {{ showForm ? 'Close' : 'Add' }}
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary btn-sm"
        (click)="toggleEdit()"
        [disabled]="!selectedEnvelopeId">
        {{ showEdit ? 'Close' : 'Edit' }}
      </button>
    </div>
    <div *ngIf="showForm">
      <app-envelope-form (envelopeAdded)="onEnvelopeAdded($event)" (closed)="toggleForm()"></app-envelope-form>
    </div>
    <div *ngIf="showEdit && selectedEnvelope">
      <app-envelope-edit
        [envelope]="selectedEnvelope"
        (saved)="onEnvelopeEdited($event)"
        (deleted)="onEnvelopeDeleted()"
        (closed)="showEdit = false">
      </app-envelope-edit>
    </div>
    <app-envelope-container
      [showForm]="showForm"
      [showButtons]="false"
      [showEdit]="showEdit"
      [monthId]="monthId"
      [envelopes]="envelopes"
      [selectedEnvelopeId]="selectedEnvelopeId"
      [loading]="loading"
      [error]="error"
      (toggleRequested)="toggleForm()"
      (editRequested)="showEdit = !showEdit"
      (envelopeSelected)="onSelect($event)">
    </app-envelope-container>
    <div *ngIf="!monthId" class="text-muted small">Select a month to view envelopes.</div>
    <div *ngIf="loading" class="text-muted small">Loading envelopes...</div>
    <div *ngIf="error" class="text-danger small">{{ error }}</div>
  </div>
</div>
